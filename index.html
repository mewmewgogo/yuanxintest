<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç­”é¢˜ä¸­...</title>
<style>
:root{--bg:#0f1117;--bg2:#181c27;--bg3:#1e2436;--border:#2a3050;--text:#e8eaf0;--text2:#8892b0;--text3:#4a5580;--accent:#4f8ef7;--green:#34d399;--red:#f87171;--yellow:#fbbf24}
*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100%;background:var(--bg);color:var(--text);font-family:"PingFang SC","Microsoft YaHei",sans-serif;font-size:15px;line-height:1.6}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:40px 20px 80px}
.topbar{width:100%;max-width:720px;display:flex;align-items:center;gap:16px;margin-bottom:32px;flex-wrap:wrap}
.counter{font-size:.82rem;color:var(--text2)}
.progress{flex:1;height:4px;background:var(--border);border-radius:99px;overflow:hidden;min-width:80px}
.progress-fill{height:100%;background:var(--accent);border-radius:99px;transition:width .5s}
.score{font-size:.8rem;font-weight:600;padding:3px 12px;background:rgba(52,211,153,.12);color:var(--green);border-radius:99px;border:1px solid rgba(52,211,153,.25)}
.card{width:100%;max-width:720px;background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:32px 36px;margin-bottom:16px;animation:slideUp .3s ease}
.q-text{font-size:1.08rem;line-height:1.9;margin-bottom:26px}
.q-num{color:var(--accent);font-weight:700;margin-right:6px}
.tag{display:inline-block;font-size:.7rem;font-weight:600;padding:2px 9px;border-radius:4px;letter-spacing:.5px;margin-bottom:14px}
.tag-single{background:rgba(79,142,247,.15);color:var(--accent)}
.tag-multi{background:rgba(251,191,36,.15);color:var(--yellow)}
.tag-judge{background:rgba(52,211,153,.15);color:var(--green)}
.tag-fill{background:rgba(248,113,113,.15);color:var(--red)}
.tag-short{background:rgba(167,139,250,.15);color:#a78bfa}
.options{display:flex;flex-direction:column;gap:10px}
.option{display:flex;align-items:flex-start;gap:14px;padding:14px 18px;border-radius:10px;border:1.5px solid var(--border);cursor:pointer;transition:all .18s;background:var(--bg3);user-select:none}
.option:hover:not(.locked){border-color:var(--text3);background:rgba(255,255,255,.03);transform:translateX(3px)}
.option.sel{border-color:var(--accent);background:rgba(79,142,247,.1)}
.option.correct{border-color:var(--green);background:rgba(52,211,153,.08)}
.option.wrong{border-color:var(--red);background:rgba(248,113,113,.08)}
.option.locked{cursor:default}
.opt-key{width:28px;height:28px;border-radius:50%;border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;flex-shrink:0;color:var(--text2);transition:all .18s}
.option.sel .opt-key{background:var(--accent);color:#fff;border-color:var(--accent)}
.option.correct .opt-key{background:var(--green);color:#fff;border-color:var(--green)}
.option.wrong .opt-key{background:var(--red);color:#fff;border-color:var(--red)}
.opt-body{font-size:.92rem;line-height:1.7;padding-top:3px}
.judge-wrap{display:flex;gap:14px}
.judge-btn{flex:1;padding:20px;border-radius:10px;border:1.5px solid var(--border);background:var(--bg3);cursor:pointer;font-size:1.1rem;font-family:inherit;transition:all .18s;display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--text)}
.judge-btn span{font-size:.78rem;color:var(--text2)}
.judge-btn:hover:not(.locked){border-color:var(--text3);transform:translateY(-2px)}
.judge-btn.sel{border-color:var(--accent);background:rgba(79,142,247,.1)}
.judge-btn.correct{border-color:var(--green);background:rgba(52,211,153,.08)}
.judge-btn.wrong{border-color:var(--red);background:rgba(248,113,113,.08)}
.judge-btn.locked{cursor:default}
.text-ans{background:var(--bg3);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:.92rem;padding:14px 18px;width:100%;outline:none;transition:border-color .18s;resize:vertical;line-height:1.7}
.text-ans:focus{border-color:var(--accent)}
.text-ans:disabled{opacity:.65}
.result{width:100%;max-width:720px;border-radius:10px;padding:20px 24px;border:1px solid;animation:fadeIn .35s ease;margin-bottom:4px}
.result.ok{border-color:rgba(52,211,153,.3);background:rgba(52,211,153,.06)}
.result.fail{border-color:rgba(248,113,113,.3);background:rgba(248,113,113,.06)}
.result.skip{border-color:rgba(251,191,36,.3);background:rgba(251,191,36,.06)}
.verdict{display:flex;align-items:center;gap:10px;font-weight:600;font-size:1rem;margin-bottom:10px}
.result.ok .verdict{color:var(--green)}
.result.fail .verdict{color:var(--red)}
.result.skip .verdict{color:var(--yellow)}
.ans-row{font-size:.85rem;color:var(--text2);line-height:1.8}
.ans-row strong{color:var(--text)}
.explain{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.06);font-size:.83rem;color:var(--text2);line-height:1.8}
.btns{display:flex;gap:10px;width:100%;max-width:720px}
.btn{flex:1;padding:12px 24px;border-radius:8px;border:none;font-family:inherit;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .18s;letter-spacing:.5px}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#3b7de8;transform:translateY(-1px)}
.btn-primary:disabled{background:var(--border);color:var(--text3);cursor:not-allowed;transform:none}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{border-color:var(--text2);color:var(--text)}
.final{width:100%;max-width:560px;text-align:center}
.score-circle{width:160px;height:160px;border-radius:50%;border:6px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg2);margin:0 auto 28px}
.score-circle.pass{border-color:var(--green);box-shadow:0 0 40px rgba(52,211,153,.2)}
.score-circle.fail{border-color:var(--red);box-shadow:0 0 40px rgba(248,113,113,.15)}
.score-num{font-size:2.8rem;font-weight:700;line-height:1}
.score-circle.pass .score-num{color:var(--green)}
.score-circle.fail .score-num{color:var(--red)}
.stats{display:flex;justify-content:center;gap:32px;margin:8px 0 32px}
.stat{text-align:center}
.stat-n{font-size:1.8rem;font-weight:700}
.stat-l{font-size:.75rem;color:var(--text2);margin-top:3px}
.review{text-align:left;width:100%;margin-bottom:28px}
.review-item{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:16px 20px;margin-bottom:8px}
.r-top{display:flex;align-items:baseline;gap:10px;margin-bottom:6px}
.r-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px}
.r-dot.ok{background:var(--green)}
.r-dot.fail{background:var(--red)}
.r-dot.skip{background:var(--yellow)}
.r-q{font-size:.85rem;flex:1;line-height:1.6}
.r-ans{font-size:.78rem;color:var(--text2);padding-left:18px;line-height:1.7}
.hidden{display:none!important}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:none}}
@media(max-width:520px){.card{padding:22px 18px}.judge-wrap{flex-direction:column}}
</style>
</head>
<body>
<div class="page">
  <div id="quiz-view" class="hidden" style="width:100%;max-width:720px;display:flex;flex-direction:column;align-items:center">
    <div class="topbar">
      <span class="counter" id="counter">ç¬¬ 1 é¢˜ / å…± 10 é¢˜</span>
      <div class="progress"><div class="progress-fill" id="progress" style="width:0%"></div></div>
      <span class="score" id="score">âœ“ 0</span>
    </div>
    <div class="card" id="q-card"></div>
    <div id="result-slot" style="width:100%;margin-bottom:16px"></div>
    <div class="btns" id="btns-a">
      <button class="btn btn-ghost" id="btn-skip" style="max-width:100px">è·³è¿‡</button>
      <button class="btn btn-primary" id="btn-submit" disabled>æäº¤ç­”æ¡ˆ</button>
    </div>
    <div class="btns hidden" id="btns-b">
      <button class="btn btn-ghost" id="btn-quit" style="max-width:120px">ç»“æŸè€ƒè¯•</button>
      <button class="btn btn-primary" id="btn-next">ä¸‹ä¸€é¢˜ â†’</button>
    </div>
  </div>
  <div id="final-view" class="hidden final">
    <div class="score-circle" id="score-circle">
      <div class="score-num" id="final-num">0</div>
      <div style="font-size:.78rem;color:var(--text2);margin-top:4px">å¾—åˆ†</div>
    </div>
    <div style="font-size:1.1rem;font-weight:600;margin-bottom:6px" id="final-msg"></div>
    <div style="font-size:.85rem;color:var(--text2);margin-bottom:28px" id="final-sub"></div>
    <div class="stats">
      <div class="stat"><div class="stat-n" id="s-correct" style="color:var(--green)">0</div><div class="stat-l">ç­”å¯¹</div></div>
      <div class="stat"><div class="stat-n" id="s-wrong" style="color:var(--red)">0</div><div class="stat-l">ç­”é”™</div></div>
      <div class="stat"><div class="stat-n" id="s-skip" style="color:var(--yellow)">0</div><div class="stat-l">è·³è¿‡</div></div>
    </div>
    <div class="review">
      <p style="font-size:.72rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:14px">ç­”é¢˜å›é¡¾</p>
      <div id="review-list"></div>
    </div>
    <button class="btn btn-primary" id="retry-btn" style="width:100%;padding:14px;font-size:1rem;letter-spacing:2px">å†åšä¸€é</button>
  </div>
  <div id="error-view" class="hidden" style="max-width:400px;text-align:center;padding:48px 24px">
    <div style="font-size:3rem;margin-bottom:16px">ğŸ˜•</div>
    <p style="color:var(--text2);line-height:1.8">é¢˜åº“ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤<br>è¯·è”ç³»è€å¸ˆé‡æ–°è·å–é“¾æ¥</p>
  </div>
</div>
<script>
function esc(s){if(!s)return'';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function shuffle(a){const r=[...a];for(let i=r.length-1;i>0;i--){const j=0|Math.random()*(i+1);[r[i],r[j]]=[r[j],r[i]]}return r}

function parseQuestions(raw){
  const lines=raw.split('\n').map(l=>l.trim()).filter(Boolean);
  const blocks=[];let cur=null;const qre=/^(\d+)[.ã€ï¼ã€‚ï¼‰)]\s*/;
  for(const line of lines){const m=line.match(qre);if(m){if(cur)blocks.push(cur);cur={num:parseInt(m[1]),lines:[line.replace(qre,'').trim()]};}else if(cur)cur.lines.push(line);}
  if(cur)blocks.push(cur);
  return blocks.map(b=>parseBlock(b)).filter(Boolean);
}

function parseBlock(block){
  const lines=block.lines;
  const ai=lines.findIndex(l=>/^ç­”æ¡ˆ[ï¼š:]/i.test(l));const ei=lines.findIndex(l=>/^è§£æ[ï¼š:]/i.test(l));
  const ans=ai>=0?lines[ai].replace(/^ç­”æ¡ˆ[ï¼š:]\s*/i,'').trim():'';
  const expLines=[];if(ei>=0){expLines.push(lines[ei].replace(/^è§£æ[ï¼š:]\s*/i,'').trim());for(let i=ei+1;i<lines.length;i++){if(/^ç­”æ¡ˆ[ï¼š:]/.test(lines[i]))break;expLines.push(lines[i]);}}
  const exp=expLines.join(' ').trim();const end=Math.min(ai>=0?ai:9999,ei>=0?ei:9999);
  const content=lines.slice(0,end);if(!content.length)return null;
  const full=content.join(' ');let type=null;
  if(/ã€å•é€‰ã€‘|ï¼ˆå•é€‰ï¼‰|\(å•é€‰\)/.test(full))type='single';
  else if(/ã€å¤šé€‰ã€‘|ï¼ˆå¤šé€‰ï¼‰|\(å¤šé€‰\)/.test(full))type='multi';
  else if(/ã€åˆ¤æ–­ã€‘|ï¼ˆåˆ¤æ–­ï¼‰|\(åˆ¤æ–­\)/.test(full))type='judge';
  else if(/ã€å¡«ç©ºã€‘|ï¼ˆå¡«ç©ºï¼‰|\(å¡«ç©º\)/.test(full))type='fill';
  else if(/ã€ç®€ç­”ã€‘|ã€é—®ç­”ã€‘|ï¼ˆç®€ç­”ï¼‰/.test(full))type='short';
  const ore=/^([A-Ja-j])[.ã€ï¼ã€‚ï¼‰)]\s*(.*)/;const opts=[],ql=[];
  for(const line of content){const om=line.match(ore);if(om)opts.push({letter:om[1].toUpperCase(),text:om[2].trim()});
  else{const c=line.replace(/ã€å•é€‰ã€‘|ã€å¤šé€‰ã€‘|ã€åˆ¤æ–­ã€‘|ã€å¡«ç©ºã€‘|ã€ç®€ç­”ã€‘|ã€é—®ç­”ã€‘|ï¼ˆå•é€‰ï¼‰|ï¼ˆå¤šé€‰ï¼‰|ï¼ˆåˆ¤æ–­ï¼‰|ï¼ˆå¡«ç©ºï¼‰|ï¼ˆç®€ç­”ï¼‰|\(å•é€‰\)|\(å¤šé€‰\)|\(åˆ¤æ–­\)|\(å¡«ç©º\)|\(ç®€ç­”\)/g,'').trim();if(c)ql.push(c);}}
  const qt=ql.join(' ').trim();if(!qt)return null;
  if(!type){if(opts.length>=2){const n=ans.replace(/[,ï¼Œ\s]/g,'').toUpperCase();type=(n.length>1&&/^[A-J]+$/.test(n))?'multi':'single';}
  else if(/^(å¯¹|é”™|æ­£ç¡®|é”™è¯¯|true|false|âˆš|Ã—|æ˜¯|å¦)$/i.test(ans))type='judge';
  else if(qt.includes('____')||qt.includes('___'))type='fill';else type='short';}
  return{id:block.num,type,text:qt,options:opts,answer:ans,explanation:exp};
}

let quizQ=[],qIdx=0,results=[],correctN=0,curAns=null,origContent='';

function init(){
  const params=new URLSearchParams(location.search);
  const quizId=params.get('quiz');
  if(!quizId){document.getElementById('error-view').classList.remove('hidden');return;}
  
  // ä» localStorage è¯»å–é¢˜åº“
  const stored=localStorage.getItem('quiz_banks');
  if(!stored){document.getElementById('error-view').classList.remove('hidden');return;}
  
  const quizzes=JSON.parse(stored);
  const quiz=quizzes.find(q=>q.id===quizId);
  if(!quiz){document.getElementById('error-view').classList.remove('hidden');return;}
  
  origContent=quiz.content;
  document.title=quiz.name;
  startQuiz(quiz.content);
}

function startQuiz(content){
  const questions=parseQuestions(content);
  if(!questions.length){document.getElementById('error-view').classList.remove('hidden');return;}
  
  quizQ=shuffle(questions);
  qIdx=0;results=[];correctN=0;curAns=null;
  document.getElementById('quiz-view').classList.remove('hidden');
  document.getElementById('final-view').classList.add('hidden');
  
  document.getElementById('btn-submit').onclick=()=>doSubmit(false);
  document.getElementById('btn-skip').onclick=()=>doSubmit(true);
  document.getElementById('btn-next').onclick=nextQ;
  document.getElementById('btn-quit').onclick=()=>{if(confirm('ç¡®å®šç»“æŸè€ƒè¯•å—ï¼Ÿ'))showFinal();};
  document.getElementById('retry-btn').onclick=()=>startQuiz(origContent);
  
  renderQ();
}

function renderQ(){
  const q=quizQ[qIdx];curAns=null;
  document.getElementById('counter').textContent='ç¬¬ '+(qIdx+1)+' é¢˜ / å…± '+quizQ.length+' é¢˜';
  document.getElementById('progress').style.width=(qIdx/quizQ.length*100)+'%';
  document.getElementById('score').textContent='âœ“ '+correctN;
  document.getElementById('result-slot').innerHTML='';
  document.getElementById('btns-a').classList.remove('hidden');
  document.getElementById('btns-b').classList.add('hidden');
  document.getElementById('btn-submit').disabled=true;
  document.getElementById('btn-next').textContent=qIdx<quizQ.length-1?'ä¸‹ä¸€é¢˜ â†’':'æŸ¥çœ‹æˆç»©';
  
  const tn={single:'å•é€‰é¢˜',multi:'å¤šé€‰é¢˜',judge:'åˆ¤æ–­é¢˜',fill:'å¡«ç©ºé¢˜',short:'ç®€ç­”é¢˜'};
  let body='';
  if(q.type==='single'||q.type==='multi'){
    body='<div class="options">'+q.options.map(o=>'<div class="option" data-l="'+o.letter+'" onclick="pickOpt(this,\''+q.type+'\')"><div class="opt-key">'+o.letter+'</div><div class="opt-body">'+esc(o.text)+'</div></div>').join('')+'</div>';
    if(q.type==='multi')body+='<p style="font-size:.75rem;color:var(--text3);margin-top:10px">å¤šé€‰é¢˜ï¼Œå¯é€‰å¤šä¸ªé€‰é¡¹</p>';
  }else if(q.type==='judge'){
    body='<div class="judge-wrap"><button class="judge-btn" data-v="å¯¹" onclick="pickJudge(this)">âœ…<span>æ­£ç¡® / å¯¹</span></button><button class="judge-btn" data-v="é”™" onclick="pickJudge(this)">âŒ<span>é”™è¯¯ / é”™</span></button></div>';
  }else{
    body='<textarea class="text-ans" id="txt-ans" rows="'+(q.type==='short'?5:2)+'" placeholder="'+(q.type==='fill'?'è¯·å¡«å†™ç­”æ¡ˆâ€¦':'è¯·ç®€è¦ä½œç­”â€¦')+'" oninput="onTxt()"></textarea>';
  }
  document.getElementById('q-card').innerHTML='<span class="tag tag-'+q.type+'">'+(tn[q.type]||q.type)+'</span><div class="q-text"><span class="q-num">'+(qIdx+1)+'.</span>'+esc(q.text)+'</div>'+body;
}

function pickOpt(el,type){
  if(el.classList.contains('locked'))return;
  if(type==='single'){document.querySelectorAll('.option').forEach(o=>o.classList.remove('sel'));el.classList.add('sel');curAns=el.dataset.l;}
  else{el.classList.toggle('sel');const s=[...document.querySelectorAll('.option.sel')].map(o=>o.dataset.l).sort().join('');curAns=s||null;}
  document.getElementById('btn-submit').disabled=!curAns;
}

function pickJudge(el){
  if(el.classList.contains('locked'))return;
  document.querySelectorAll('.judge-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');curAns=el.dataset.v;
  document.getElementById('btn-submit').disabled=false;
}

function onTxt(){
  const v=document.getElementById('txt-ans').value.trim();
  curAns=v||null;
  document.getElementById('btn-submit').disabled=!v;
}

function doSubmit(skip){
  const q=quizQ[qIdx];const ans=skip?null:curAns;const correct=!skip&&checkAns(q,ans);
  if(correct)correctN++;results.push({q,ans,correct,skip});
  document.querySelectorAll('.option,.judge-btn').forEach(e=>e.classList.add('locked'));
  const ta=document.getElementById('txt-ans');if(ta)ta.disabled=true;
  
  if(q.type==='single'||q.type==='multi'){
    const cl=q.answer.toUpperCase().replace(/[,ï¼Œ\s]/g,'').split('');
    document.querySelectorAll('.option').forEach(o=>{
      if(cl.includes(o.dataset.l)){o.classList.add('correct');o.classList.remove('sel');}
      else if(o.classList.contains('sel')){o.classList.add('wrong');o.classList.remove('sel');}
    });
  }else if(q.type==='judge'){
    document.querySelectorAll('.judge-btn').forEach(b=>{
      if(judgeMatch(b.dataset.v,q.answer)){b.classList.add('correct');b.classList.remove('sel');}
      else if(b.classList.contains('sel')){b.classList.add('wrong');b.classList.remove('sel');}
    });
  }
  
  const cls=skip?'skip':correct?'ok':'fail';
  const icon=skip?'â­ï¸':correct?'âœ…':'âŒ';
  const label=skip?'å·²è·³è¿‡':correct?'å›ç­”æ­£ç¡®':'å›ç­”é”™è¯¯';
  document.getElementById('result-slot').innerHTML='<div class="result '+cls+'"><div class="verdict"><span style="font-size:1.3rem">'+icon+'</span>'+label+'</div><div class="ans-row">'+(!skip&&ans?'ä½ çš„ç­”æ¡ˆï¼š'+esc(ans)+'<br>':'')+'<strong>æ­£ç¡®ç­”æ¡ˆï¼š'+esc(q.answer)+'</strong></div>'+(q.explanation?'<div class="explain"><span style="color:var(--accent);font-weight:600;margin-right:6px">ğŸ“– è§£æ</span>'+esc(q.explanation)+'</div>':'')+'</div>';
  document.getElementById('btns-a').classList.add('hidden');
  document.getElementById('btns-b').classList.remove('hidden');
}

function nextQ(){qIdx++;if(qIdx>=quizQ.length){showFinal();return;}renderQ();window.scrollTo({top:0,behavior:'smooth'});}

function checkAns(q,ans){
  if(!ans)return false;
  const c=q.answer.trim().toUpperCase().replace(/[,ï¼Œ\s]/g,'');
  const u=ans.toUpperCase().replace(/[,ï¼Œ\s]/g,'');
  if(q.type==='single'||q.type==='multi')return u===c;
  if(q.type==='judge')return judgeMatch(u,c);
  const kws=c.split(/[ã€ï¼Œ,\s]+/).filter(Boolean);
  return kws.length>0&&kws.every(w=>u.includes(w));
}

function judgeMatch(a,b){
  const pos=s=>/^(å¯¹|æ­£ç¡®|true|âˆš|æ˜¯|t|y|1)$/i.test(s);
  const neg=s=>/^(é”™|é”™è¯¯|false|Ã—|å¦|f|n|0)$/i.test(s);
  if(pos(a)&&pos(b))return true;if(neg(a)&&neg(b))return true;
  return a.toUpperCase()===b.toUpperCase();
}

function showFinal(){
  document.getElementById('quiz-view').classList.add('hidden');
  document.getElementById('final-view').classList.remove('hidden');
  const total=quizQ.length;
  const correct=results.filter(r=>r.correct).length;
  const wrong=results.filter(r=>!r.correct&&!r.skip).length;
  const skip=results.filter(r=>r.skip).length;
  const score=Math.round(correct/total*100);
  document.getElementById('final-num').textContent=score;
  document.getElementById('score-circle').className='score-circle '+(score>=60?'pass':'fail');
  const msgs=[[90,'ä¼˜ç§€ï¼ç»§ç»­ä¿æŒ ğŸ‰'],[75,'è‰¯å¥½ï¼Œè¿˜æœ‰è¿›æ­¥ç©ºé—´ ğŸ‘'],[60,'åŠæ ¼ï¼Œéœ€è¦åŠ å¼ºå¤ä¹  ğŸ“š'],[0,'ä¸åŠæ ¼ï¼Œè¯·è®¤çœŸå¤ä¹  ğŸ’ª']];
  document.getElementById('final-msg').textContent=msgs.find(([m])=>score>=m)[1];
  document.getElementById('final-sub').textContent='å…± '+total+' é¢˜ Â· ç­”å¯¹ '+correct+' é¢˜';
  document.getElementById('s-correct').textContent=correct;
  document.getElementById('s-wrong').textContent=wrong;
  document.getElementById('s-skip').textContent=skip;
  const tn={single:'å•é€‰',multi:'å¤šé€‰',judge:'åˆ¤æ–­',fill:'å¡«ç©º',short:'ç®€ç­”'};
  document.getElementById('review-list').innerHTML=results.map((r,i)=>{
    const s=r.skip?'skip':r.correct?'ok':'fail';
    const sl=r.skip?'è·³è¿‡':r.correct?'æ­£ç¡®':'é”™è¯¯';
    return'<div class="review-item"><div class="r-top"><div class="r-dot '+s+'"></div><div class="r-q">'+(i+1)+'. ['+(tn[r.q.type]||r.q.type)+'] '+esc(r.q.text.slice(0,60))+(r.q.text.length>60?'â€¦':'')+'</div><span style="font-size:.72rem;color:var(--text3)">'+sl+'</span></div><div class="r-ans">'+(!r.skip&&r.ans?'ä½ ï¼š'+esc(r.ans)+' ï½œ ':'')+'æ­£ç¡®ï¼š'+esc(r.q.answer)+'</div></div>';
  }).join('');
  window.scrollTo({top:0,behavior:'smooth'});
}

window.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
